<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Kasir - TAKOYAKI NE</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #fffbe6;
      margin: 0;
      padding: 20px;
      color: #333;
    }

    header {
      background-color: #ffd700;
      color: #333;
      padding: 15px;
      text-align: center;
      border-radius: 8px;
    }

    header img {
      height: 80px;
      vertical-align: middle;
      margin-right: 10px;
    }

    h2 {
      color: #ffb300;
      border-bottom: 2px solid #ffb300;
      padding-bottom: 5px;
    }

    .menu, .addon {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      margin-top: 15px;
    }

    .product {
      background-color: #fff;
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      text-align: center;
    }

    .product p {
      margin: 5px 0;
      font-size: 14px;
    }

    .qty-controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 6px;
      margin-top: 8px;
    }

    .qty-controls button {
      background-color: #ffb300;
      color: white;
      border: none;
      font-size: 18px;
      padding: 4px 8px;
      border-radius: 5px;
      cursor: pointer;
    }

    .qty-controls span {
      font-size: 18px;
      font-weight: bold;
    }

    .qty-controls button:hover {
      background-color: #ffa000;
    }

    .cart, .payment {
      margin-top: 30px;
    }

    .cart-item {
      margin: 5px 0;
    }

    .payment button {
      background-color: #4caf50;
      color: white;
      border: none;
      padding: 10px 15px;
      margin-right: 10px;
      border-radius: 5px;
      cursor: pointer;
    }

    .payment button:hover {
      background-color: #45a049;
    }

    .total {
      font-size: 18px;
      font-weight: bold;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <header>
    <img src="logo.png" alt="TAKOYAKI NE">
    <h1>TAKOYAKI NE</h1>
    <p>Kasir: Budi | Tanggal: <span id="tanggal"></span> | Jam: <span id="jam"></span></p>
  </header>
  <h2>MENU TAKOYAKI</h2>
  <div class="menu">
    <div class="product"><p>Sosis - Small</p><p>Rp12.000</p><div class="qty-controls"><button onclick="decreaseItem('Sosis-Small')">-</button><span id="qty-Sosis-Small">0</span><button onclick="increaseItem('Sosis-Small', 12000)">+</button></div></div>
    <div class="product"><p>Sosis - Medium</p><p>Rp17.000</p><div class="qty-controls"><button onclick="decreaseItem('Sosis-Medium')">-</button><span id="qty-Sosis-Medium">0</span><button onclick="increaseItem('Sosis-Medium', 17000)">+</button></div></div>
    <div class="product"><p>Sosis - Large</p><p>Rp22.000</p><div class="qty-controls"><button onclick="decreaseItem('Sosis-Large')">-</button><span id="qty-Sosis-Large">0</span><button onclick="increaseItem('Sosis-Large', 22000)">+</button></div></div>
  </div>

  <h2>TAMBAH ISI</h2>
  <div class="addon">
    <div class="product"><p>Sosis - Small</p><p>Rp2.000</p><div class="qty-controls"><button onclick="decreaseAddon('Sosis-Small')">-</button><span id="addon-Sosis-Small">0</span><button onclick="increaseAddon('Sosis-Small', 2000)">+</button></div></div>
    <div class="product"><p>Sosis - Medium</p><p>Rp3.000</p><div class="qty-controls"><button onclick="decreaseAddon('Sosis-Medium')">-</button><span id="addon-Sosis-Medium">0</span><button onclick="increaseAddon('Sosis-Medium', 3000)">+</button></div></div>
    <div class="product"><p>Sosis - Large</p><p>Rp5.000</p><div class="qty-controls"><button onclick="decreaseAddon('Sosis-Large')">-</button><span id="addon-Sosis-Large">0</span><button onclick="increaseAddon('Sosis-Large', 5000)">+</button></div></div>
  </div>

  <h2>PILIHAN TOPPING</h2>
  <form id="topping-form" style="margin-top: 10px;">
    <div class="product" style="text-align: left;">
      <label><input type="checkbox" name="topping" value="Saos Takoyaki"> Saos Takoyaki</label><br>
      <label><input type="checkbox" name="topping" value="Saos Mayonise"> Saos Mayonise</label><br>
      <label><input type="checkbox" name="topping" value="Saos Pedas"> Saos Pedas</label><br>
      <label><input type="checkbox" name="topping" value="Dicampur"> Dicampur</label><br>
      <label><input type="checkbox" name="topping" value="Dipisah"> Dipisah</label>
    </div>
  </form>

  <h2>STATUS MEMBER</h2>
  <form id="member-form" style="margin-top: 10px;">
    <label><input type="checkbox" id="member-discount"> Kartu Member (Potongan Rp5.000)</label><br>
    <label><input type="checkbox" id="member-free"> Kartu Member Free (Bonus 1x item)</label>
  </form>

  <div class="cart">
    <h2>RINCIAN PESANAN</h2>
    <div id="cart-items"></div>
    <p class="total">Total: Rp<span id="total">0</span></p>
  </div>

  <div class="payment">
    <h2>PEMBAYARAN</h2>
    <button onclick="simpanDanBayar('Tunai')">Bayar Tunai</button>
    <button onclick="simpanDanBayar('QRIS')">Bayar QRIS</button>
    <button onclick="cancelOrder()" style="background-color:#f44336;">Batal</button>
  </div>

  <script>
    let cart = {};
    let addons = {};

    function updateWaktu() {
      const sekarang = new Date();
      const optionsTanggal = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      const tanggal = sekarang.toLocaleDateString('id-ID', optionsTanggal);
      const jam = sekarang.toLocaleTimeString('id-ID');
      document.getElementById('tanggal').textContent = tanggal;
      document.getElementById('jam').textContent = jam;
    }

    setInterval(updateWaktu, 1000);
    updateWaktu();

    function increaseItem(name, price) {
      if (!cart[name]) cart[name] = { qty: 0, price };
      cart[name].qty++;
      updateCart();
    }

    function decreaseItem(name) {
      if (cart[name] && cart[name].qty > 0) {
        cart[name].qty--;
        updateCart();
      }
    }

    function increaseAddon(name, price) {
      if (!addons[name]) addons[name] = { qty: 0, price };
      addons[name].qty++;
      updateCart();
    }

    function decreaseAddon(name) {
      if (addons[name] && addons[name].qty > 0) {
        addons[name].qty--;
        updateCart();
      }
    }

    function getSelectedToppings() {
      const checkboxes = document.querySelectorAll('input[name="topping"]:checked');
      return Array.from(checkboxes).map(cb => cb.value);
    }

    function updateCart() {
      const cartItems = document.getElementById('cart-items');
      const totalDisplay = document.getElementById('total');
      cartItems.innerHTML = '';
      let total = 0;

      for (let name in cart) {
        const item = cart[name];
        const qtySpan = document.getElementById(`qty-${name}`);
        if (qtySpan) qtySpan.textContent = item.qty;
        if (item.qty > 0) {
          cartItems.innerHTML += `<div class="cart-item">${name} x ${item.qty} = Rp${item.qty * item.price}</div>`;
          total += item.qty * item.price;
        }
      }

      for (let name in addons) {
        const item = addons[name];
        const qtySpan = document.getElementById(`addon-${name}`);
        if (qtySpan) qtySpan.textContent = item.qty;
        if (item.qty > 0) {
          cartItems.innerHTML += `<div class="cart-item">${name} (+ Isi) x ${item.qty} = Rp${item.qty * item.price}</div>`;
          total += item.qty * item.price;
        }
      }

      const toppings = getSelectedToppings();
      if (toppings.length > 0) {
        cartItems.innerHTML += `<div class="cart-item">Topping: ${toppings.join(', ')}</div>`;
      }

      const isMemberDiscount = document.getElementById('member-discount')?.checked;
      const isMemberFree = document.getElementById('member-free')?.checked;

      if (isMemberDiscount) {
        total -= 5000;
        cartItems.innerHTML += `<div class="cart-item">Potongan Member: -Rp5.000</div>`;
      }

      let bonusCount = 0;
      if (total >= 35000) bonusCount++;
      if (isMemberFree) bonusCount++;

      if (bonusCount > 0) {
        cartItems.innerHTML += `<div class="cart-item">Bonus: ${bonusCount}x Item Gratis</div>`;
      }

      totalDisplay.textContent = total < 0 ? 0 : total;
    }

    function cancelOrder() {
      cart = {};
      addons = {};
      document.querySelectorAll('input[name="topping"]').forEach(cb => {
        cb.checked = false;
        cb.disabled = false;
      });
      document.getElementById('member-discount').checked = false;
      document.getElementById('member-free').checked = false;
      document.querySelectorAll('[id^="qty-"], [id^="addon-"]').forEach(span => {
        span.textContent = '0';
      });
      updateCart();
    }

    function formatLine(left, right, width = 32) {
      const space = width - left.length - right.length;
      return left + ' '.repeat(space > 0 ? space : 0) + right;
    }

    function formatHarga(qty, harga) {
      return `x${qty} @ Rp. ${harga.toLocaleString('id-ID')}`;
    }

    function formatTotal(harga) {
      return `Rp. ${harga.toLocaleString('id-ID')}`;
    }

    function centerText(text, width = 32) {
      const space = Math.floor((width - text.length) / 2);
      return ' '.repeat(space > 0 ? space : 0) + text;
    }

    function simpanDanBayar(method) {
      const nomorTransaksi = "TX-" + Date.now();
      const waktu = new Date().toISOString().split("T")[0];
      const kasir = "Budi";
      let total = 0;
      let struk = "";

      struk += formatLine("No. Transaksi", nomorTransaksi) + "\n";
      struk += centerText("TAKOYAKI NE") + "\n";
      struk += centerText("Alfamart Ngelom") + "\n";
      struk += centerText("Telp: 083 890 890 296") + "\n";
      struk += "-".repeat(32) + "\n";
      struk += formatLine("Kasir", kasir) + "\n";
      struk += formatLine("Metode", method) + "\n";
      struk += formatLine("Waktu", new Date().toLocaleString('id-ID')) + "\n";
      struk += "-".repeat(32) + "\n";

      for (let name in cart) {
        const item = cart[name];
        if (item.qty > 0) {
          const subtotal = item.qty * item.price;
          struk += name + "\n";
          struk += formatLine(formatHarga(item.qty, item.price), formatTotal(subtotal)) + "\n";
          total += subtotal;
        }
      }

      for (let name in addons) {
        const item = addons[name];
        if (item.qty > 0) {
          const subtotal = item.qty * item.price;
          struk += name + " (+Isi)\n";
          struk += formatLine(formatHarga(item.qty, item.price), formatTotal(subtotal)) + "\n";
          total += subtotal;
        }
      }

      const toppings = getSelectedToppings();
      if (toppings.length > 0) {
        struk += "-".repeat(32) + "\n";
        struk += formatLine("Topping", toppings.join(", ")) + "\n";
      }

      const isMemberDiscount = document.getElementById('member-discount')?.checked;
      const isMemberFree = document.getElementById('member-free')?.checked;

      if (isMemberDiscount) {
        total -= 5000;
        struk += formatLine("Diskon Member", "-Rp. 5.000") + "\n";
      }

      let bonusCount = 0;
      if (total >= 35000) bonusCount++;
      if (isMemberFree) bonusCount++;

      if (bonusCount > 0) {
        struk += "-".repeat(32) + "\n";
        struk += formatLine("Bonus", `${bonusCount}x Item Gratis`) + "\n";
      }

      struk += "-".repeat(32) + "\n";
      struk += formatLine("TOTAL", formatTotal(total < 0 ? 0 : total)) + "\n";
      struk += "-".repeat(32) + "\n";
      struk += centerText("Terima kasih!") + "\n";
      struk += centerText("Selamat menikmati!") + "\n\n";

      window.location.href = "rawbt:" + encodeURIComponent(struk);

      const transaksi = JSON.parse(localStorage.getItem('transaksi')) || [];
      transaksi.push({
        waktu,
        nomorTransaksi,
        total: total < 0 ? 0 : total,
        method,
        struk
      });
      localStorage.setItem('transaksi', JSON.stringify(transaksi));
      alert("Transaksi berhasil disimpan!");
      cancelOrder();
    }

    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('input[name="topping"]').forEach(cb => {
        cb.addEventListener('change', updateCart);
      });

      document.getElementById('member-discount').addEventListener('change', updateCart);
      document.getElementById('member-free').addEventListener('change', updateCart);

      const dicampur = document.querySelector('input[name="topping"][value="Dicampur"]');
      const dipisah = document.querySelector('input[name="topping"][value="Dipisah"]');

      if (dicampur && dipisah) {
        dicampur.addEventListener('change', () => {
          dipisah.disabled = dicampur.checked;
        });
        dipisah.addEventListener('change', () => {
          dicampur.disabled = dipisah.checked;
        });
      }
    });
  </script>
</body>
</html>
